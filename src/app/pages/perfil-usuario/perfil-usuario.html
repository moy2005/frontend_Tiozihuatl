<section class="min-h-screen bg-gray-50 py-10 flex justify-center">
  <div class="bg-white shadow-xl rounded-xl p-8 w-full max-w-3xl">

    <!-- Header -->
    <div class="text-center mb-8">
      <h2 class="text-2xl font-semibold text-indigo-700">Perfil de Usuario</h2>
      <span class="mt-2 inline-block px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full font-semibold text-sm">
        Rol: {{ user.rol || 'Cargando...' }}
      </span>
    </div>

    <!-- Loading -->
    <div *ngIf="cargando" class="text-center py-10">
      <i class="fas fa-spinner fa-spin text-indigo-600 text-3xl"></i>
      <p class="text-gray-500 mt-2">Cargando datos...</p>
    </div>

    <!-- Datos -->
    <form *ngIf="!cargando">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <ng-container *ngFor="let campo of ['nombre','a_paterno','a_materno','correo','telefono','matricula','carrera','semestre']">
          <div *ngIf="mostrarCampo(campo)">
            <label class="font-semibold text-gray-700 capitalize">{{ campo.replace('_',' ') }}</label>
            <input
              [(ngModel)]="user[campo]"
              name="{{campo}}"
              [disabled]="!editando || !editable(campo)"
              class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition"
            />
          </div>
        </ng-container>
      </div>

      <!-- Botones de acci칩n -->
      <div class="mt-8 flex justify-between items-center flex-wrap gap-3">
        <button type="button" (click)="cerrarSesion()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">
          Cerrar sesi칩n
        </button>

        <div class="flex gap-3">
          <button *ngIf="!editando" type="button" (click)="habilitarEdicion()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">Editar</button>
          <button *ngIf="editando" type="button" (click)="guardarCambios()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">Guardar</button>
          <button *ngIf="editando" type="button" (click)="editando=false" class="bg-gray-400 text-white px-4 py-2 rounded-lg hover:bg-gray-500">Cancelar</button>
        </div>
      </div>
    </form>

    <hr class="my-8 border-gray-300" />

<!-- Cambio de contrase침a -->
<div>
  <h3 class="text-lg font-semibold text-indigo-700 mb-3">Cambiar contrase침a</h3>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <input type="password" [(ngModel)]="contrasenaActual" placeholder="Contrase침a actual"
           class="input border p-2 rounded-lg" />

    <input type="password" [(ngModel)]="nuevaContrasena" placeholder="Nueva contrase침a"
           (input)="onPasswordInput()"
           class="input border p-2 rounded-lg" />
  </div>

  <!-- Barra de seguridad -->
  <div class="space-y-2 mt-3">
    <div class="flex items-center justify-between text-xs">
      <span class="text-gray-600 font-medium">Seguridad de contrase침a:</span>
      <span
        [ngClass]="{
          'text-red-600': passwordStage === 1,
          'text-yellow-600': passwordStage === 2,
          'text-green-600': passwordStage === 3,
          'text-gray-400': passwordStage === 0
        }"
        class="font-medium">
        {{ passwordStage === 0 ? 'Sin evaluar' : passwordStage === 1 ? 'D칠bil' : passwordStage === 2 ? 'Media' : 'Fuerte' }}
      </span>
    </div>
    <div class="h-1.5 w-full bg-gray-200 rounded-full overflow-hidden">
      <div
        [ngClass]="{
          'w-1/3 bg-red-500': passwordStage === 1,
          'w-2/3 bg-yellow-500': passwordStage === 2,
          'w-full bg-green-500': passwordStage === 3
        }"
        class="h-full transition-all duration-300"></div>
    </div>
  </div>

  <!-- Requisitos -->
  <div *ngIf="showPasswordTip" class="mt-3 p-3 bg-gray-50 rounded-lg border border-gray-200">
    <p class="text-xs font-medium text-gray-700 mb-1.5">La contrase침a debe contener:</p>
    <ul class="space-y-1 text-xs">
      <li class="flex items-center gap-2" [ngClass]="nuevaContrasena.length >= 8 ? 'text-green-600' : 'text-gray-500'">
        <i [ngClass]="nuevaContrasena.length >= 8 ? 'fas fa-check-circle' : 'far fa-circle'"></i>
        M칤nimo 8 caracteres
      </li>
      <li class="flex items-center gap-2" [ngClass]="hasUppercase() ? 'text-green-600' : 'text-gray-500'">
        <i [ngClass]="hasUppercase() ? 'fas fa-check-circle' : 'far fa-circle'"></i>
        Una letra may칰scula
      </li>
      <li class="flex items-center gap-2" [ngClass]="hasLowercase() ? 'text-green-600' : 'text-gray-500'">
        <i [ngClass]="hasLowercase() ? 'fas fa-check-circle' : 'far fa-circle'"></i>
        Una letra min칰scula
      </li>
      <li class="flex items-center gap-2" [ngClass]="hasNumber() ? 'text-green-600' : 'text-gray-500'">
        <i [ngClass]="hasNumber() ? 'fas fa-check-circle' : 'far fa-circle'"></i>
        Un n칰mero
      </li>
      <li class="flex items-center gap-2" [ngClass]="hasSpecialChar() ? 'text-green-600' : 'text-gray-500'">
        <i [ngClass]="hasSpecialChar() ? 'fas fa-check-circle' : 'far fa-circle'"></i>
        Un car치cter especial (@$!%*?&)
      </li>
    </ul>
  </div>

  <button (click)="cambiarContrasena()"
          class="bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600 mt-4">
    Actualizar contrase침a
  </button>
</div>


    <!-- 游 Solo visible si el rol es Administrador -->
    <div *ngIf="user.rol === 'Administrador'" class="mt-8 text-center">
      <button (click)="irPanelAdmin()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
        Ir al panel de administrador
      </button>
    </div>
  </div>
</section>
